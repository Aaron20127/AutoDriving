一、概述：
本方法是基于坐标点追踪的方法，使用的是基于二轮自行车的纯追踪算法。算法的demo在pure_persuit_demo.py文件中。
原纯最终博客地址在：https://blog.csdn.net/AdamShan/article/details/80555174

二、使用纯追踪算法的先决条件：
1.车头朝向
2.轨迹坐标

三、追踪原理
车在行驶过程中指定前方一个追踪的点，车的原点位置和追踪点形成一条直线。将这条直线看成一个扇形的弧的两个端点连城的直线，则这个直线对应圆形的弧线就是车应该行驶的轨迹。要使车沿着弧线运动，关键是让车前轮与弧形轨迹相切。当车向前行驶ds时，车与追踪点的直线将发生改变，则弧形轨迹也将发生改变。根据一些几何关系，加上车头方向就可以计算出前轮应该转过的角度。具体参考pure_persuit_demo.py文件和纯追踪算法博客。

四、整个实现控制流程
1.所有的坐标点是按0.5米每个点采集的。然后使用二次拟合的方式求出每个坐标点的曲率，每次拟合只使用3个点，且效果比较理想。

2.对车的速度曲率关系进行测试，就是找到车的每个速度能行驶的最大曲率，得到一个曲率速度列表。目前使用的是圆圈进行测试，
  测试的曲率在0.001-0.225之间，每次步进0.0001;测试的速度在12-200km/h之间，每次步进0.1km/h。测得在12-145km/h都有对应不同的曲率，在145-200km/h之间则都对应0.0009。所以对高速部分还要把曲率再细分到0.00001，这样在高速行驶时才能更加平滑的加速或减速。

3.使用椭圆轨迹测试自动驾驶小车。椭圆的曲率最大和最小位置在椭圆的长轴和短轴处，只要以椭圆的最大和最小曲率为参数，就能绘制出一个椭圆，并得到椭圆轨迹坐标，这样就能模拟任意弯曲的道路。

4.自动判断小车是否通过圆形轨道测试。使用小车的坐标到圆心的距离减去圆的半径，得到的就是偏离轨道的距离。如果该距离大于0.35米，就表示测试不通过。

5.自动判断小车是否通过椭圆轨道测试。还没有想到一个好的计算偏离椭圆轨迹的方法。

五、关键的问题
1.如何实现小车匀速行驶？
（1）车速未达到目标速度，throttle=1；车速超过目标速度throttle=0；且轻微采刹车。
存在问题：不能达到真正地匀速，行驶时会在目标速度上下波动。
（2）车速未达到目标速度，throttle=0.2 + (target_speed - current_speed)；车速超过目标速度throttle=0；且轻微采刹车。
问题解决：由于存在一个反馈，能使throttle最终保持在0-1.0之间的一个值，使小车匀速行驶。匀速行驶的速度略小于目标速度。
不足之处：当加速时，throttle容易等于1，不是很拟人。减速时，容易将刹车踩死，同样不太拟人。当然这可能是因为车的油门和刹车不太灵敏造成的。

2.如何实现让小车顺利的入弯和出弯？
小车在行驶时，实时监测车前方和后方的若干坐标点，得到最大的曲率，以此作为当前的目标速度。监测的车前方的点的个数应该多于车后方的点数，且监测的点数应该和车当前的速度存在函数关系。例如，当前车速为speed，则监测后方的点数可为20+0.1*speed，监测前方的点的个数为20+speed，只是一个参考。这样在入弯的时候就可以提前减速到合适的速度；而出弯的时候由于参考了后方的点，不会导致出弯时加速过快开出车道的情况。

3.如何实时绘制车的行驶轨迹，且不影响对车的实时控制？
要让车始终行驶在车轨道上，必须对车实时控制。在一个单进程中，由于在控制车的同时又要绘制车的行驶轨迹，导致对车的控制时间减少，使车偏离轨迹。所以应该减少对行驶轨迹的绘制时间，增加对车的控制时间。以前每个循环绘制一次轨迹，改成10次循环绘制一次轨迹，或者专门开启一个用于绘制轨迹的进程，并使用管道通信。实验表明，两种方法都能使车得到实时控制，开启新进程的效果更好一点。

4.如何自动识别车是否偏离椭圆轨迹？
如果车在椭圆轨迹上，车的当前位置和椭圆的圆心形成的向量的模应该等于该向量与椭圆轨迹的交点到圆心的距离。但实际计算出来的值不准确？需要进一步解决。